rules_version = '2';

service cloud.firestore {
  // Match the specific database named "ecom"
  match /databases/ecom/documents {

    // Allow authenticated users to manage their own data.
    // This includes reading, writing (creating, updating, deleting) documents
    // and listing collections under their own user ID path (e.g., /users/theirUID/products/productID).
    // The {document=**} is a recursive wildcard, covering documents and subcollections.
    match /users/{userId}/{document=**} {
      allow read, write: if request.auth != null && request.auth.uid == userId;
    }

    // By default, if no rule above matches, access is denied.
    // You can add more specific rules for other top-level collections here if needed.
  }
}
