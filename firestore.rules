rules_version = '2';

service cloud.firestore {
  match /databases/(default)/documents {

    // Rules for user authentication profiles
    match /auth_users/{userEmail} {
      // Allow client to get a specific user's profile (for AppLayout to check isApproved, isAdmin)
      allow get: if true;
      // Disallow client from listing, creating, updating, or deleting user profiles directly.
      // These operations are handled by Server Actions.
      allow list, create, update, delete: if false;
    }

    // Rules for the GLOBAL shared product data
    // All authenticated users can read. Only admin can write/delete.
    match /shared_products/{productId} {
      allow read: if request.auth != null; // Any authenticated user can read
      allow write, delete: if request.auth != null && request.auth.token.email == 'gustavo.cordeiro@altenburg.com.br' && request.auth.token.email_verified == true;
    }

    // Rules for the GLOBAL metadata for shared products
    match /app_metadata/products_metadata {
      allow read: if request.auth != null; // Any authenticated user can read
      allow get, write, update, delete: if request.auth != null && request.auth.token.email == 'gustavo.cordeiro@altenburg.com.br' && request.auth.token.email_verified == true;
    }

    // Fallback rule: deny access to any other paths not defined above.
    match /{path=**} {
      allow read, write: if false;
    }
  }
}
